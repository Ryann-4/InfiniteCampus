<html>
    <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-7SV03ZXJ9R">
        </script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-7SV03ZXJ9R');
        </script>
        <title>
            Infinite Campus
        </title>
        <link id="dynamic-favicon" rel="icon" type="image/png" href="https://codehs.com/uploads/f111a37947de2cea81db858094c04f2d">
        <link rel="stylesheet" href="global.min.css">
        <meta name="keywords" content="Infinite campus,infinite campus,Infinite Campus,infinite Campus">
        <meta name="description" content="Infinite Campus Is A International Buisiness And Has Good Devs">
        <meta property="og:title" content="Infinite Campus">
        <meta property="og:description" content="Infinite Campus Is An International Buisiness And Has Good Devs">
        <meta property="og:url" content="https://ryann-4.github.io/InfiniteCampus/">
        <meta name="theme-color" content="#8cbe37">
        <meta content="https://codehs.com/uploads/30883de2def50482be6e6fb25ea68477" property="og:image">
        <script src="main.js">
        </script>
        <script src="title.js">
        </script>
        <script src="global.js">
        </script>
  <style>

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      display: flex;
      align-items: flex-start;
      margin-bottom: 15px;
      background-color: black;
      color:white;
      border: 2px solid;
      padding: 10px;
      border-radius: 5px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .content {
      flex: 1;
    }

    .timestamp {
      font-size: 0.75em;
      color: #999;
    }
  </style>
</head>
<body>

  <h1>Discord Messages</h1>

  <form id="sendForm">
    <input class="button" type="text" id="nameInput" placeholder="Your name" required /><br>
    <input class="button" type="text" id="msgInput" placeholder="Type your message..." required />
    <button class="button" type="submit">
      Send
    </button>
  </form>

  <ul class="message" id="messages"></ul>

  <script>
    const backendUrl = 'https://discord-proxy1.onrender.com/';

    async function fetchMessages() {
      try {
        const res = await fetch(backendUrl + '/api/messages');
        const data = await res.json();
        const list = document.getElementById('messages');
        list.innerHTML = '';
        data.reverse().forEach(msg => {
          const li = document.createElement('li');
          const avatarUrl = `https://cdn.discordapp.com/avatars/${msg.author.id}/${msg.author.avatar}.png`;
          const timestamp = new Date(msg.timestamp).toLocaleString();
          li.innerHTML = `
            <img src="${avatarUrl}" class="avatar" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
            <div class="content">
              <strong>${msg.author.username}</strong>
              <div>${msg.content}</div>
              <div class="timestamp">${timestamp}</div>
            </div>
          `;
          list.appendChild(li);
        });
      } catch (err) {
        console.error('Error fetching messages:', err);
      }
    }

    async function sendMessage(name, content) {
      try {
        await fetch(backendUrl + '/send', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: `message=${encodeURIComponent(name + "\n" + content)}`
        });
        document.getElementById('msgInput').value = '';
        document.getElementById('nameInput').value = '';
        fetchMessages();
      } catch (err) {
        console.error('Error sending message:', err);
      }
    }

    document.getElementById('sendForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('nameInput').value.trim();
      const msg = document.getElementById('msgInput').value.trim();
      if (name && msg) sendMessage(name, msg);
    });

    fetchMessages();
    setInterval(fetchMessages, 5000);
  </script>
<script src="drypopup.js">
        </script>
        <script src="footer.js">
        </script>
        <script src="header.js">
        </script>
</body>
</html>