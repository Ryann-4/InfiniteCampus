<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Site Crawler with Categories</title>
<style>
    :root { --bg:#0b0c10; --card:#151821; --ink:#eaeef7; --muted:#aab2c5; --accent:#7aa2ff; }
  body { margin:0; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--ink); }
  header { padding:20px; background:linear-gradient(135deg, #1c2233, #0f1320); border-bottom:1px solid #222a3a; }
  h1 { margin:0 0 8px; font-size:20px; font-weight:700; }
  p.hint { margin:0; color:var(--muted); font-size:13px; }
  main { padding:16px; max-width:1100px; margin:0 auto; }
  .controls { display:grid; gap:12px; grid-template-columns: 1fr repeat(3, minmax(120px, 180px)) 140px; align-items:end; }
  .controls label { font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }
  .controls input[type="text"], .controls input[type="number"] {
    width:100%; padding:10px 12px; border-radius:12px; border:1px solid #2a3347; background:var(--card); color:var(--ink);
  }
  .controls .row { display:flex; gap:12px; align-items:center; }
  .controls .chk { display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted); }
  button {
    padding:12px 14px; border:0; border-radius:14px; background:var(--accent); color:#0a0d18; font-weight:700; cursor:pointer;
    box-shadow:0 8px 24px rgba(122,162,255,.25);
  }
  button:disabled { opacity:.6; cursor:not-allowed; box-shadow:none; }
  .status { margin:14px 0 0; font-size:13px; color:var(--muted); }
  .grid { margin-top:18px; display:grid; gap:14px; }
  details { background:var(--card); border:1px solid #2a3347; border-radius:14px; overflow:hidden; }
  summary {
    padding:12px 14px; cursor:pointer; font-weight:600; list-style:none; display:flex; gap:12px; align-items:center;
    border-bottom:1px solid #242b3d;
  }
  summary::-webkit-details-marker { display:none }
  .pill { font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid #2a3347; color:var(--muted); }
  .ok    { color:#9effa6; border-color:#33523a; }
  .warn  { color:#ffd27a; border-color:#5a4a2b; }
  .bad   { color:#ff9e9e; border-color:#5a2b2b; }
  .url { word-break:break-all; }
  pre {
    margin:0; padding:14px; overflow:auto; max-height:420px; background:#0e111a; color:#cdd7ff; font-size:12px; line-height:1.4;
  }
  .rowline { padding:10px 14px; font-size:12px; color:var(--muted); border-top:1px solid #242b3d; background:#0f1320; }
  .flex { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
body { background:#0b0c10; color:#eaeef7; font-family:sans-serif; margin:0; }
header { padding:10px; background:#151821; }
main { padding:10px; }
pre { background:#0e111a; color:#cdd7ff; padding:10px; overflow:auto; max-height:400px; }
.pill { font-size:11px; padding:3px 6px; border-radius:999px; border:1px solid #2a3347; }
.ok { color:#9effa6; }
.warn { color:#ffd27a; }
.bad { color:#ff9e9e; }
h2 { margin-top:30px; border-bottom:1px solid #333; padding-bottom:4px; }
</style>
</head>
<body>
<header>
  <h1>Site Crawler (list.xml Categories)</h1>
  <p>Crawls your site from list.xml and displays files in HTML, JS, and Other categories.</p>
</header>
<main>
  <label>Start URL: <input id="startUrl" type="text" style="width:300px"></label>
  <label>Max Pages: <input id="maxPages" type="number" value="100"></label>
  <button id="startBtn">Start</button>
  <div id="status">Idle.</div>
  <div id="htmlSection"><h2>HTML Files</h2></div>
  <div id="jsSection"><h2>JavaScript Files</h2></div>
  <div id="otherSection"><h2>Other Files</h2></div>
</main>
<script>
(function(){
  const startUrl = document.getElementById('startUrl');
  const maxPages = document.getElementById('maxPages');
  const startBtn = document.getElementById('startBtn');
  const statusEl = document.getElementById('status');
  const htmlSection = document.getElementById('htmlSection');
  const jsSection = document.getElementById('jsSection');
  const otherSection = document.getElementById('otherSection');
  startUrl.value = location.origin + '/';

  const ESC = { '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;' };
  function escapeHTML(s) { return String(s).replace(/[&<>"']/g, ch => ESC[ch]); }

  function addResult(parent, url, cls, content) {
    const details = document.createElement('details');
    const summary = document.createElement('summary');
    summary.innerHTML = `<span class="pill ${cls}">${cls.toUpperCase()}</span> ${escapeHTML(url)}`;
    const pre = document.createElement('pre');
    pre.textContent = content;
    details.appendChild(summary);
    details.appendChild(pre);
    parent.appendChild(details);
  }

  async function parseListXML(start) {
    const base = new URL(start);
    const listURL = new URL('/list.xml', base).toString();
    try {
      const res = await fetch(listURL, { credentials: 'include' });
      if (!res.ok) throw new Error('list.xml not found');
      const txt = await res.text();
      const dom = new DOMParser().parseFromString(txt, 'application/xml');
      // grab <loc> elements in any namespace
      const locs = Array.from(dom.getElementsByTagNameNS("*", "loc")).map(n => n.textContent.trim());
      return locs.filter(u => u.startsWith(base.origin));
    } catch(e) {
      console.error(e);
      return [];
    }
  }

  function categorizeAndSort(urls) {
    const htmlFiles = [];
    const jsFiles = [];
    const otherFiles = [];
    urls.forEach(url => {
      const ext = (url.split('.').pop() || '').toLowerCase();
      if (ext === 'html' || ext === 'htm') htmlFiles.push(url);
      else if (ext === 'js') jsFiles.push(url);
      else otherFiles.push(url);
    });
    htmlFiles.sort(); jsFiles.sort(); otherFiles.sort();
    return { htmlFiles, jsFiles, otherFiles };
  }

  async function crawl() {
    htmlSection.innerHTML = "<h2>HTML Files</h2>";
    jsSection.innerHTML = "<h2>JavaScript Files</h2>";
    otherSection.innerHTML = "<h2>Other Files</h2>";
    const start = startUrl.value.trim() || location.origin + '/';
    const limitPages = Math.max(1, parseInt(maxPages.value) || 1);

    statusEl.textContent = "Loading list.xml...";
    let urls = await parseListXML(start);
    if (!urls.length) urls = [start];

    const { htmlFiles, jsFiles, otherFiles } = categorizeAndSort(urls);
    const allFiles = [...htmlFiles, ...jsFiles, ...otherFiles].slice(0, limitPages);

    let count = 0;
    for (const file of allFiles) {
      statusEl.textContent = `Fetching ${file} (${++count}/${allFiles.length})`;
      try {
        const res = await fetch(file, { credentials: 'include' });
        const text = await res.text();
        const cls = res.ok ? 'ok' : 'warn';
        if (htmlFiles.includes(file)) addResult(htmlSection, file, cls, text);
        else if (jsFiles.includes(file)) addResult(jsSection, file, cls, text);
        else addResult(otherSection, file, cls, text);
      } catch(e) {
        if (htmlFiles.includes(file)) addResult(htmlSection, file, 'bad', e.message);
        else if (jsFiles.includes(file)) addResult(jsSection, file, 'bad', e.message);
        else addResult(otherSection, file, 'bad', e.message);
      }
    }
    statusEl.textContent = "Done.";
  }

  startBtn.addEventListener('click', crawl);
})();
</script>
</body>
</html>
