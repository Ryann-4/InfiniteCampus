<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7SV03ZXJ9R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7SV03ZXJ9R');
    </script>
    <title>Infinite Campus</title>
    <link id="dynamic-favicon" rel="icon" type="image/png" href="https://codehs.com/uploads/f111a37947de2cea81db858094c04f2d">
    <link rel="stylesheet" href="global.min.css">
    <script src="main.js"></script>
    <script src="title.js"></script>
    <script src="countdown.js"></script>
    <script src="global.js"></script>
    <style>
        select, input, button {
            margin: 0.5em;
            padding: 0.5em;
            font-size: 1em;
        }

        /* Styling for countdown popup */
        #popup {
            width: 300px;
            padding: 20px;
            background-color: lightblue;
            border: 1px solid #ccc;
            position: absolute;
            top: 60px;
            right: 0;
            cursor: move;
            z-index: 100;
            display: none;
        }

        #popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #popup .close-btn {
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
        }

        #countdown {
            font-size: 18px;
        }

        .time-section {
            font-size: 1.2em;
        }

    </style>
</head>
<body>
    <center>
        <br><br><br><br>
        <h1 class="tptxt">Countdown Timer</h1>
        <div>
            <label class="txt" for="format">Date Format:</label><br>
            <select class="button" id="format">
                <option class="button" value="mdy">MM/DD/YYYY</option>
                <option class="button" value="dmy">DD/MM/YYYY</option>
            </select>
        </div>
        <div>
            <input class="button" id="dateInput" placeholder="Enter date (EX: 12/25/2026)" />
        </div>
        <div>
            <button class="button" onclick="startCountdown()">Start Countdown</button>
        </div>
        <div class="time-section" id="days"></div>
        <div class="time-section" id="hours"></div>
        <div class="time-section" id="minutes"></div>
        <div class="time-section" id="seconds"></div>
        <p class="ajt">Also join the <a href="https://discord.gg/4d9hJSVXca" class="discord">Discord</a></p>
        <br><br>

        <!-- Countdown Popup -->
        <div id="popup">
            <div id="popup-header">
                <span>Countdown</span>
                <span class="close-btn" onclick="closePopup()">X</span>
            </div>
            <div id="countdown">
                <p id="days"></p>
                <p id="hours"></p>
                <p id="minutes"></p>
                <p id="seconds"></p>
            </div>
        </div>
    </center>

    <script src="drypopup.js"></script>
    <script src="footer.js"></script>
    <script src="header.js"></script>
    <script>
        let timer;

        // Start Countdown Function
        function startCountdown() {
            clearInterval(timer);
            const format = document.getElementById("format").value;
            const dateStr = document.getElementById("dateInput").value.trim();
            const parsedDate = parseDateTime(dateStr, format);

            if (!parsedDate || isNaN(parsedDate.getTime())) {
                alert("Invalid date.");
                return;
            }

            // Save the target date to localStorage
            localStorage.setItem('countdownTarget', parsedDate.toISOString());

            // Show the popup and start the countdown
            document.getElementById('popup').style.display = 'block';

            timer = setInterval(() => updateCountdown(parsedDate), 1000);
            updateCountdown(parsedDate);
        }

        // Parse Date Function (No time part, just date)
        function parseDateTime(dateStr, format) {
            const dateParts = dateStr.split("/");
            if (dateParts.length !== 3) return null;
            let day, month, year;
            if (format === "mdy") {
                [month, day, year] = dateParts;
            } else {
                [day, month, year] = dateParts;
            }
            return new Date(parseInt(year), parseInt(month) - 1, parseInt(day), 0, 0, 0);
        }

        // Update Countdown Display
        function updateCountdown(targetDate) {
            const now = new Date();
            let diff = Math.floor((targetDate - now) / 1000);

            if (diff <= 0) {
                clearInterval(timer);
                document.getElementById("days").textContent = "Time's up!";
                document.getElementById("hours").textContent = "";
                document.getElementById("minutes").textContent = "";
                document.getElementById("seconds").textContent = "";
                closePopup(); // Close the popup when the countdown is finished
                return;
            }

            const days = Math.floor(diff / (60 * 60 * 24));
            diff %= (60 * 60 * 24);
            const hours = Math.floor(diff / 3600);
            diff %= 3600;
            const minutes = Math.floor(diff / 60);
            const seconds = diff % 60;

            document.getElementById("days").textContent = `Days: ${days}`;
            document.getElementById("hours").textContent = `Hours: ${hours}`;
            document.getElementById("minutes").textContent = `Minutes: ${minutes}`;
            document.getElementById("seconds").textContent = `Seconds: ${seconds}`;
        }

        // Close the Countdown Popup
        function closePopup() {
            document.getElementById("popup").style.display = 'none';
            localStorage.removeItem('countdownTarget'); // Optionally clear the countdown from localStorage
        }

        // Make the countdown popup draggable
        let offsetX, offsetY, isDragging = false;

        document.getElementById('popup').addEventListener('mousedown', (e) => {
            isDragging = true;
            offsetX = e.clientX - document.getElementById('popup').offsetLeft;
            offsetY = e.clientY - document.getElementById('popup').offsetTop;
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                document.getElementById('popup').style.left = `${e.clientX - offsetX}px`;
                document.getElementById('popup').style.top = `${e.clientY - offsetY}px`;
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        // Check if there is a saved countdown in localStorage when the page loads
        window.onload = function() {
            const savedTime = localStorage.getItem('countdownTarget');
            if (savedTime) {
                const parsedDate = new Date(savedTime);
                document.getElementById('popup').style.display = 'block';
                timer = setInterval(() => updateCountdown(parsedDate), 1000);
                updateCountdown(parsedDate);
            }
        };
    </script>
</body>
</html>
